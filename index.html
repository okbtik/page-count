<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小説ページ数カウントサイト</title>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --bg-color: #f8f9fa;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 10px;
            background-color: var(--bg-color);
            color: #333;
            font-size: 16px;
        }

        /* ナビゲーション */
        nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        nav button {
            background: #eee;
            color: #555;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
        }
        nav button.active {
            background: var(--primary-color);
            color: white;
        }

        /* コンテンツ切り替え */
        .page { display: none; }
        .page.active { display: block; }

        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1 { text-align: center; color: #2c3e50; font-size: 1.5rem; margin-bottom: 20px; }
        h3 { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; font-size: 1.2rem; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* スマホ対応：グリッドを1列に */
        @media (max-width: 600px) {
            .grid { grid-template-columns: 1fr; }
            body { padding: 10px; }
            h1 { font-size: 1.2rem; }
        }

        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        .required::after { content: " *"; color: var(--error-color); }
        input, textarea, select { width: 100%; padding: 12px; margin-top: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
        
        .main-btn { background: var(--primary-color); color: white; border: none; padding: 15px; width: 100%; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; margin-top: 10px; }
        
        .result { background: #d4edda; color: #155724; padding: 20px; border-radius: 8px; margin-top: 20px; border: 1px solid #c3e6cb; }
        .result p { margin: 10px 0; font-size: 1.1rem; }
        #resPages { font-size: 2.2rem; color: var(--success-color); }

        /* ポリシー用 */
        .policy-text { font-size: 14px; color: #666; }

        /* お問い合わせフォーム用 */
        #contactForm iframe { display: none; }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XRPWF2LBGD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XRPWF2LBGD');
</script>
<body>

    <nav>
        <button onclick="showPage('tool')" id="btn-tool" class="active">計算ツール</button>
        <button onclick="showPage('policy')" id="btn-policy">プライバシーポリシー・免責事項</button>
        <button onclick="showPage('contact')" id="btn-contact">お問い合わせ</button>
    </nav>

    <div id="tool" class="page active">
        <h1>小説ページ数カウントサイト</h1>
	<div style="text-align: center; "><p>新人賞応募、同人誌作成、背幅算出などにお使いください。</p></div>
        <div class="card">
            <h3>基本設定（必須）</h3>
            <div class="grid">
                <div>
                    <label class="required">1行の文字数</label>
                    <input type="number" id="charsPerLine" value="42">
                </div>
                <div>
                    <label class="required">1ページの行数</label>
                    <input type="number" id="linesPerPage" value="17">
                </div>
            </div>
            <label class="required">本文</label>
	    <small>
	・「＊次章＊」で改ページ（「＊」は全角）<br>
	・空白、空白行もカウントします<br>
	・設定文字数+1文字目が「、」「。」「？」「！」やカッコの場合、そこまで1行に含めます
	    <small>
            <textarea id="mainContent" rows="10" placeholder="ここに本文を貼り付けてください...

入力された本文データは利用者様のデバイス内でのみ処理・利用され、外部に送信・保存されることはありません。安心してお使いください。"></textarea>
        </div>

        <div class="card">
            <h3>背幅計算用設定（任意）</h3>
            <div class="grid">
                <div>
                    <label>1枚当たりの用紙の厚み [mm] </label>
                    <input type="number" id="paperThickness" value="0.10" step="0.01" placeholder="例: 0.10">
                </div>
                <div>
                    <label>本文以外のページ数</label>
                    <input type="number" id="extraPages" value="0">
                </div>
            </div>
        </div>

        <button class="main-btn" onclick="calculate()">計算を実行する</button>

        <div id="output" class="result" style="display:none;">
            <h3>【計算結果】</h3>
            <p>換算ページ数: <strong id="resPages">0</strong> ページ</p>
            <p>総行数: <span id="resLines" style="font-weight:bold;">0</span> 行</p>
            <p>背表紙の厚さ目安: <span id="resSpine" style="font-weight:bold;">0</span> mm</p>
        </div>
    </div>

    <div id="policy" class="page">
        <div class="card policy-text">
            <h3>プライバシーポリシー・免責事項</h3>
            <p><strong>【プライバシーポリシー】</strong><br>
            (1) 計算ツールに入力された本文データをサーバーに送信することはありません。すべての計算処理はユーザーのブラウザ上で行われます。<br>(2) 当サイトでは、ご意見・お問い合わせの際、名前やメールアドレス等の個人情報を入力いただく場合がございます。取得した個人情報は、ご意見・お問い合わせに対してのご連絡をする場合に利用させていただくものであり、この目的以外では利用いたしません。</p>
            <p><strong>【免責事項】</strong><br>
            本ツールではできるだけ正確な計算方法を採用していますが、あくまでも計算結果は目安であり、実際の印刷結果や応募規定との合致を保証するものではありません。特に禁則処理やルビの扱いにより、実際のページ数と異なる場合があります。本ツールを利用したことによるトラブルや損害について、制作者は一切の責任を負いません。</p>
            <p><strong>【アクセス解析ツールについて】</strong><br>
	    当サイトでは、Googleによるアクセス解析ツール「Googleアナリティクス」を利用しています。このGoogleアナリティクスはトラフィックデータの収集のためにCookieを使用しております。トラフィックデータは匿名で収集されており、個人を特定するものではありません。
        </div>
    </div>

    <div id="contact" class="page">
        <div class="card">
            <h3>お問い合わせ</h3>
            <p style="font-size: 0.9rem; color: #666;">返信が必要な場合はメールアドレスを入力してください。<br>すべてのお問い合わせにお応えできないことがあります。<br>予めご了承ください。</p>
            
            <form id="contactForm" onsubmit="return submitContact();">
                <label class="required">お名前</label>
                <input type="text" id="name" required>

                <label>メールアドレス</label>
                <input type="email" id="email">

                <label class="required">お問い合わせ内容</label>
                <textarea id="message" rows="5" required></textarea>

                <button type="submit" class="main-btn">送信する</button>
            </form>
            <div id="contactThanks" style="display:none;" class="result">
                お問い合わせありがとうございます。送信が完了しました。
            </div>
        </div>
    </div>

    <script>
        // ページ切り替え
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.getElementById('btn-' + pageId).classList.add('active');
        }

        // 計算ロジック
        function calculate() {
            const charsPerLine = parseInt(document.getElementById('charsPerLine').value);
            const linesPerPage = parseInt(document.getElementById('linesPerPage').value);
            const content = document.getElementById('mainContent').value.trim();
            const thickness = parseFloat(document.getElementById('paperThickness').value) || 0;
            const extraPages = parseInt(document.getElementById('extraPages').value) || 0;

            if (!charsPerLine || !linesPerPage || !content) {
                alert("必須項目を入力してください。");
                return;
            }

            const lines = content.split('\n');
            let totalPages = 1;
            let currentLinesInPage = 0;
            const kinsokuChars = ['、', '。', '？', '！', '」', '』', '）'];

            lines.forEach((line) => {
                if (line.includes('＊次章＊')) {
                    if (currentLinesInPage > 0) { totalPages++; currentLinesInPage = 0; }
                    return;
                }
                if (line.length === 0) {
                    currentLinesInPage++;
                } else {
                    let charsInRow = 0;
                    for (let i = 0; i < line.length; i++) {
                        charsInRow++;
                        if (charsInRow === charsPerLine) {
                            if (i + 1 < line.length && kinsokuChars.includes(line[i + 1])) { i++; }
                            currentLinesInPage++;
                            charsInRow = 0;
                        }
                    }
                    if (charsInRow > 0) currentLinesInPage++;
                }
                if (currentLinesInPage >= linesPerPage) {
                    totalPages += Math.floor(currentLinesInPage / linesPerPage);
                    currentLinesInPage %= linesPerPage;
                }
            });

            const finalPages = (currentLinesInPage === 0 && totalPages > 1) ? totalPages - 1 : totalPages;
            const spineWidth = ((finalPages + extraPages) / 2) * thickness;

            document.getElementById('resPages').innerText = finalPages;
            document.getElementById('resLines').innerText = (finalPages - 1) * linesPerPage + currentLinesInPage;
            document.getElementById('resSpine').innerText = spineWidth.toFixed(2);
            document.getElementById('output').style.display = 'block';
            document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
        }

        // お問い合わせ送信処理 (Google Form 連携用)
        function submitContact() {
            const GOOGLE_FORM_ACTION_URL = "https://docs.google.com/forms/u/0/d/e/あなたのフォームID/formResponse";
            
            // 各項目の entry.xxxxxx ID を調べて以下を書き換える
            const entryName = "entry.1224719684"; 
            const entryEmail = "entry.585512296";
            const entryMsg = "entry.1772384956";

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;

            const formData = new FormData();
            formData.append(entryName, name);
            formData.append(entryEmail, email);
            formData.append(entryMsg, message);

            // fetchを使用してバックグラウンドで送信
            fetch(GOOGLE_FORM_ACTION_URL, {
                method: "POST",
                mode: "no-cors",
                body: formData
            }).then(() => {
                document.getElementById('contactForm').style.display = 'none';
                document.getElementById('contactThanks').style.display = 'block';
            }).catch(() => alert("送信に失敗しました。"));

            return false; // 通常のsubmitを防止
        }
    </script>
</body>
</html>
